language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
  - PACT_BROKER_BASE_URL=https://alombardi.pact.dius.com.au
  # PACT_BROKER_TOKEN is encrypted below
  - secure: "iJt//qjUEyF543Mn9thec3hgL+hqrT7KNv2I/1l0jeZ9dV/lMfKFmdhMD87trtFVWE2mZd3uWxglPqjudaAdPM4v3zclpZfa5AggzeKcRhcGEHZCIIX5xjZBECnvhd8YHpIzWY7K+DJIY4PFmLvE/vFQU3wy7USkitKNe4Tr+JyIyPVI3TAwA//tynBrm98NP39QNh452wrFBQkQHLAt7QFNlpkxpx6dBe8USNwHIfP7/q0oeplNkGufbbEjFUGANVkTWM09fpaUOgB4s9mi6Rh3hO4nCPlUOixjhuNhSANiOOQQhI6Ka1aNz8aRL6SfKNzNOvIG/BPfuSucesLl4jfIDvbKSiqLWZs80wPBaCP7s8oFBCfjpaKXonGeiaSBdT4lsXxf3mQDJeLsgZw4x9NpQYdJhTJpQKCiqJtQFRpWVAg9phAcpRuSpllifkl4Y/mQkLvMmz1WtP5PMDPpUUmFKPLcg5zwwRJiSUiugzxm11iX7+/aU4jpuxFAFhoIeSWrmejQ3MrZJ2D2wbbslCZfEMgQsYp7/K07boJuJfRzVex92VvovwJBqt6PCZUHyy0sZ1znRucs7OB2OtK7Y5zC44OQdveMNKn6al4XUY+SRROVkn6TbuQxLWV0umMyW5QwujjYACYijptxnlJPAvqp7nLokg0LSV9msYFbpCg="
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
